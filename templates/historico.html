{% extends 'layout.html' %}
{% block title %}Histórico & Performance{% endblock %}
{% block content %}
<header>
    <h1><i class="fa-solid fa-chart-line"></i> Histórico & Performance</h1>
    <p><a href="{{ url_for('index') }}" class="btn"><i class="fa-solid fa-arrow-left nav-link-icon"></i>Voltar ao Dashboard</a></p>
</header>
<hr>

<div class="card">
    <h2>Performance por Categoria</h2>
    {% if performance_categorias %}
        <table style="width:100%; border-collapse: collapse;">
            <thead>
                <tr style="text-align: left; border-bottom: 2px solid #444;">
                    <th style="padding: 8px;">Categoria</th>
                    <th style="padding: 8px;">Tarefas Finalizadas</th>
                    <th style="padding: 8px;">Sucessos (No Prazo)</th>
                    <th style="padding: 8px;">Taxa de Sucesso</th>
                </tr>
            </thead>
            <tbody>
                {% for cat in performance_categorias %}
                <tr style="border-bottom: 1px solid #444;">
                    <td style="padding: 8px;">
                        <i class="fa-solid {{ cat.icone or 'fa-circle-question' }}" style="color: {{ cat.cor or '#cccccc' }};"></i>
                        {{ cat.categoria_nome }}
                    </td>
                    <td style="padding: 8px;">{{ cat.total_finalizadas }}</td>
                    <td style="padding: 8px;">{{ cat.total_sucessos }}</td>
                    <td style="padding: 8px;">
                        {% if cat.total_finalizadas > 0 %}
                            {{ (cat.total_sucessos * 100 / cat.total_finalizadas)|round(1) }}%
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Ainda não há tarefas finalizadas para analisar a performance.</p>
    {% endif %}
</div>

<div class="card">
    <h2>Log de Atividades Recentes</h2>
    {% if log_atividades %}
        <ul>
            {% for log in log_atividades %}
                <li>
                    {% if log.status == 'Concluída' %}
                        <i class="fa-solid fa-circle-check" style="color: #4dbd74;"></i>
                        <strong>Concluída:</strong> {{ log.titulo }} 
                        <small>(em {{ log.data_conclusao.split(' ')[0].split('-')[2] }}/{{ log.data_conclusao.split(' ')[0].split('-')[1] }}/{{ log.data_conclusao.split(' ')[0].split('-')[0] }})</small>
                    {% elif log.status == 'Não Concluída' %}
                        <i class="fa-solid fa-circle-xmark" style="color: #dc3545;"></i>
                        <strong>Não Concluída:</strong> {{ log.titulo }} 
                        <small>(venceu em {{ log.data_vencimento.split('-')[2] }}/{{ log.data_vencimento.split('-')[1] }}/{{ log.data_vencimento.split('-')[0] }})</small>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Nenhuma atividade recente registrada.</p>
    {% endif %}
</div>
{% endblock %}